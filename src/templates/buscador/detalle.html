{% extends 'index-buscador.html' %}

{% load crispy_forms_tags %}

{% block content %}
<div class="br-mainpanel" style="position: relative;">

  <div class="br-pageheader pd-y-15 pd-md-l-20">
    <nav class="breadcrumb pd-0 mg-0 tx-12">
      <a class="breadcrumb-item"> {{proyecto}}</a>
      <a class="breadcrumb-item" href="{% url 'Bandejaeys' %}">Bandeja Entrada y Salida</a>      
      <span class="breadcrumb-item active">Detalle Paquete</span>
    </nav>
  </div><!-- br-pageheader -->
  <div class="pd-x-20 pd-sm-x-30 pd-t-20 pd-sm-t-30">
    <h4 class="tx-gray-800 mg-b-5">Historial de documento</h4>
  </div>
  <div class="br-pagebody mg-t-5 pd-x-30">
  <div class="col-lg-12">
    <div class="card shadow-base bd-0">
      <div class="form-layout form-layout-7 ">               
              <div class="row no-gutters">
              <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                Código
              </div><!-- col-4 -->
              <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                {{documento.Codigo_documento}}
              </div><!-- col-8 -->
              </div> 
              <div class="row no-gutters">
              <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
               Descripción
              </div><!-- col-4 -->
              <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                {{documento.Descripcion}}
              </div><!-- col-8 -->
              </div> 
              <div class="row no-gutters">
                <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  Emisor
                </div><!-- col-4 -->
                <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                {{documento.owner}}
                </div><!-- col-8 -->
              </div>
              <div class="row no-gutters">
                <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;text-transform:capitalize;">
                  Fecha Primera Emisión
                </div><!-- col-4 -->
                <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  {{first_date|date:'d-m-y'}}
                </div><!-- col-8 -->
              </div>              
               <div class="row no-gutters">
                <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  Fecha Última Emisión
                </div><!-- col-4 -->
                <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  {{last_date|date:'d-m-y'}}
                </div><!-- col-8 -->
              </div>               <div class="row no-gutters">
                <div class="col-5 col-sm-4" style="text-align: center;color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  Tiempo de ciclo
                </div><!-- col-4 -->
                <div class="col-7 col-sm-8" style="color:black;font-weight: 900;font-size: 13px;justify-content: flex-start;text-transform:capitalize;">
                  {{delta_date}} días
                </div><!-- col-8 -->
              </div>                                           
      </div>
      <div class="card bd-0 shadow-base dataTables_wrapper no-footer " style="padding:20px;"id="mydatatable-container">
                <table id="mydatatable" class="records_list table table-striped table-bordered table-hover table-primary" role="grid" aria-describedby="datatable1_info" style="width: 100%">
                  <thead>
                    <tr role="row"> 
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="0" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Emisor</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="1" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Revisión</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="2" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Transmittal</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="3" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Estado</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="4" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Fecha</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="4" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Hora</th>
                      <th class="tx-10-force tx-mont tx-medium hidden-xs-down"tabindex="5" aria-controls="datatable2" rowspan="1" colspan="1"  aria-sort="ascending"style="vertical-align:center;text-align:center;text-align:center;color:#fff;">Archivo</th>
                                </tr>
                    <tr>
                     <th style="text-align: center;vertical-align: middle;padding: 5px; font-size: 10px;"colspan="6">
                      </th>
                      <th style="text-align: center; vertical-align: middle;padding: 5px; font-size: 10px;">
                      <form method="POST">{% csrf_token %}
                        <input type="submit" class="btn btn-warning" style="text-align: center;padding:2px;"value="Descargar ZIP">
                      </form>
                  </th >

                  </thead>
                  <tbody>
                    {% for version in versiones %}
                    <tr role="row" class="odd">
                      <td class="valign-middle hidden-xs-down"tabindex="0" class="sorting_1"style="vertical-align:center;text-align:center;">{{version.owner.first_name}} {{version.owner.last_name}}</td>
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;"> {{version.get_revision_display}} </td>    
                      {% if version.paquete_set.all.0 %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;"> <a href="{% url 'paquete-detalle' version.paquete_set.all.0.pk %}" >{{version.paquete_set.all.0.codigo}} </a></td>
                      
                      {% else %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;"> <a></a></td>

                      {% endif %}       
                      {% if not version.estado_contratista %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;">{{version.get_estado_cliente_display}}</td>
                      {% endif %}
                      {% if not version.estado_cliente %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;">{{version.get_estado_contratista_display}}</td>
                      {% endif %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;">{{version.fecha|date:'d-m-y'}}</td>
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;">{{version.fecha|date:'H:i'}}</td>
                      {% if version.archivo.url is not None %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;"><a href="{{version.archivo.url}}"><i class="icon ion-archive fa-1x"></i></a></td>
                      {% else %}
                      <td class="valign-middle hidden-xs-down"style="vertical-align:center;text-align:center;">Sin documento adjunto.</td>
                      {% endif %} 
                     
                      {% empty %}
                      <h4> El Documento {{documento}}, no tiene Versiones </h4>
                      {% endfor %}    
                    </tr>
                    </tbody>
                  </table>

          <div class="row no-gutters" style="float: left;margin-top: 10px;margin-right: 10px;margin-bottom: 10px;">
            <a onclick="history.back();"><button  class="btn btn-warning tx-11 tx-uppercase pd-y-12 pd-x-25 tx-mont tx-medium mg-l-10" type="buttom"> volver </button></a>
          </div> 
      </div>
     
    </div><!-- br-contentpanel -->   
   
  </div><!-- card -->
  
</div><!-- card-header -->        
</div>
 <script>
  $(document).ready(function() {
      $('#mydatatable').DataTable(
        {
         "dom": 'B<"float-right"f>t<"float-left"l>p<"clearfix">',
          "responsive": true,
          "bSort": false,
          "language": {
          "url": "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
          },
          "order":[[4,"desc"]],
          buttons:{
            dom: {
                button: {
                    className: 'btn btn-success'
                }
            },
          },
          buttons:[ 
            {
                //definimos estilos del boton de excel
                extend: "excelHtml5",
                text:'Exportar a Excel',
                className:'btn btn-success',

                // 1 - ejemplo básico - uso de templates pre-definidos
                //definimos los parametros al exportar a excel
              customize: function( xlsx ) {
                var sheet = xlsx.xl.worksheets['sheet1.xml'];
 
                $('row c[r^="C"]', sheet).attr( 's', '2' );
            },
                 excelStyles: {               // Apply the 'header_blue' template part (white font on a blue background in the header/footer)
                    template:"blue_medium",
                    
                    
                },

            }]	     
        });
  } );
</script>
{% endblock content %}
    