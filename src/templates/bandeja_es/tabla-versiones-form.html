{% extends 'index-blank.html' %}

{% load static %}

{% load crispy_forms_tags %}

{% block content %}

<div class="br-contentpanel">
<div class="br-subleft">
      <div class="pd-10">
        <a  href="{% url 'paquete-preview' %}" class="btn btn-warning bd-0 btn-compose"><i class="icon ion-ios-compose-outline"></i> Nuevo Paquete</a>
      </div>
    
      <h6 class="tx-uppercase tx-10 mg-t-40 pd-x-10 bd-b pd-b-10 tx-roboto tx-white-7">SECCIONES</h6>

      <nav class="nav br-nav-mailbox flex-column">
        <a href="{% url 'Bandejaeys' %}" class="nav-link active"><i class="icon fa fa-reply"></i> Recibidos</a>
        <a href="{% url 'Borradores' %}" class="nav-link"><i class="icon icon ion-edit"></i> Borradores</a>
        <a href="{% url 'bandeja-enviados' %}" class="nav-link"><i class="icon fa fa-share"></i> Enviados</a>
      </nav>
</div>
<div class="pd-x-20 pd-sm-x-30 pd-t-20 pd-sm-t-30">
    <h4 class="tx-gray-800 mg-b-5">CREAR PAQUETE</h4>
</div>
<div class="br-pagebody pd-x-20 pd-sm-x-30">
    <div class="card bd-0 shadow-base">  
            <form class="form-group mg-t-20" id="form_paquete" action="" method="post">{% csrf_token %}
                        <p>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>
                    
                        <table>
                        {{ wizard.management_form }}
                        {% if wizard.form.forms %}
                            {{ wizard.form.management_form|crispy }}
                            {% for form in wizard.form.forms %}
                                {{ form|crispy }}
                            {% endfor %}
                        {% else %}
                            {{ wizard.form|crispy }}
                        {% endif %}
                        </table>
                        {% if wizard.steps.prev %}
                        <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.first }}">Paso 1</button>
                        <button name="wizard_goto_step" type="submit" value="{{ wizard.steps.prev }}">Paso siguiente</button>
                        {% endif %}
                        <input type="submit" value="submit">
                        
                    </form>

      </div>
    <div id="tablaVersiones">
         <table class="table table-responsive table-striped mg-b-0 table-bordered table-primary">
            <thead>
                <tr>
                    <th style="text-align: center;border: 2px;border-color: grey; color: white;"> Documento </th>
                    <th style="text-align: center;border: 2px;border-color: grey; color: white;"> Revisión </th>
                    <th style="text-align: center;border: 2px;border-color: grey; color: white;"> Estado Cliente </th>
                    <th style="text-align: center;border: 2px;border-color: grey; color: white;"> Estado Contratista </th>

                </tr>
            </thead>
              <tbody>
                  <tr v-for="fila in filas">
                  <td style="text-align: center;border: 2px;border-color: grey; color: black;" >[[ fila ]]</td>
                  </tr>
              </tbody>
          </table>
        </div>
    </div>
     
  </div>
  
</div>
  <!--FIN PANEL PRINCIPAL-->
    
</div>
 
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

{% block js %}

<script>
$(document).ready(function() {
    $('.select2').select2({
    language: "es",
    placeholder: 'seleccione un Documento',
    ajax: {
        url: "{% url 'datos-baes'%}",
        dataType: 'json',
          processResults: function (data) {
                    return {
                        results: $.map(data, function (item) {
                            return {id: item.id, text: item.Codigo_documento};
                        })
                    };
                }
            }
       });
});
</script>


<script language="JavaScript" type="text/javascript">
    $("#cargar").removeAttr('onsubmit').click(function submitVersionHandler(e){
        e.preventDefault();
        e.stopImmediatePropagation();
        const form = document.getElementById('form')
        $.ajax({
            type: 'POST',
            url: ".",
            data: $("#form").serialize(),
            dataType: 'json',
            success: successHandler
        })
        function successHandler(data){
                if (data.msg === 'Success'){
                    alert('Formulario guardado en correctamente.')
                }
                if (data.msg === 'Invalid'){
                    alert('Ha ocurrido un error al crear el formulario de version.\nRevise la información ingresada e intente nuevamente.')
                }
            }
    }
)   

</script>
<script src="{% static 'file_form/file_form.js' %}"></script>
<script>
   initUploadFields(
      document.getElementById("id_prev_archivo")
   );
</script>
{% endblock js %}

{% endblock content %}
