{% extends 'index-base.html' %}

{% block navegacion %}
  <div class="br-pageheader pd-y-15 pd-l-20">
    <nav class="breadcrumb pd-0 mg-0 tx-12">
      <a class="breadcrumb-item" > {{proyecto}} </a>
      <span class="breadcrumb-item active">Panel De Carga</span>
    </nav>
  </div>
{% endblock navegacion %}


{% block content %}

<!--Titulo-->
  <div class="pd-x-20 pd-sm-x-30 pd-t-20 pd-sm-t-30">
    <h4 class="tx-gray-800 mg-b-5">Panel de carga de entregables.</h4>
    <p class="mg-b-0"></p>
  </div>

  <div class="br-section-wrapper">
<!--Tabla-->
  <div class="row row-sm d-flex justify-content-center" >
  <!--Upload Archivos-->
        <div class="col-12 bd rounded mg-t-10">
          
          <ul class="col-lg-12 nav nav-pills  justify-content-center" role="tablist">
            
          <h4 class="mg-b-0 tx-uppercase tx-bold tx-inverse tx-poppins mg-t-10" style="text-align: left; margin-right: 30px;" >{{proyecto}}</h4>
            <form  class="nav-item "method="POST" enctype="multipart/form-data">
            {% csrf_token %}

               <li class="nav-item float-left mg-t-7" style="width: auto;"><a class="nav-link active"><input type="file" name="importfile" id="file" onchange="fileValidation()"></a></li>

              <li class="nav-item float-left"style="width: auto;"><a class="nav-link"><button class="btn btn-outline-danger" type="submit"> Importar </button></a></li>

            </form>

            <li class="nav-item float-left"style="width: auto;"><a class="nav-link" href="{% url 'documento-crear' %}"><button class="btn btn-outline-primary">Insertar por formulario</button></a></li>
         
            <li class="nav-item float-left"style="width: auto;"><a class="nav-link" href="{% url 'panel-export' %}"><button class="btn btn-outline-success"> Descargar Excel </button></a></li>
          </ul>
        </div>
  <!--Table-->
      <div class="rounded table-responsive">
        <table class="table table-striped mg-b-0 table-bordered table-warning" id="tblData">
          <thead>
            <tr>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;">Nombre</th>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;">Especialidad</th>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;">Tipo <br> Doc.</th>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;">Descripcion <br>Documentos</th>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;">NÂ° Documento <br>Contractual</th>
              <th style="text-align: center;border: 2px;border-color: grey; color: white;" colspan="2">Fecha Programada de Emision</th>              
              <th style="text-align: center;border: 2px;border-color: grey; color: white;" colspan="2">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
              <th style="text-align: center;border: 5px;border-color: black; color: grey;">Inicio Emision en Rev B</th>              
              <th style="text-align: center;border: 5px;border-color: black; color: grey;">Emision en Rev 0</th>
              <th style="text-align: center;border: 5px;border-color: black; color: black;">Modificar</th>
              <th style="text-align: center;border: 5px;border-color: black; color: black;">Eliminar</th>
            </tr>
            <!--Loop Listar Documento-->
            {% for documento in documentos %}
            <tr>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.nombre}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.especialidad}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.tipo}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.descripcion}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.num_documento}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.fecha_inicio_Emision}} </th>
                <th style="text-align: center;border: 2px;border-color: grey; color: black;" > {{documento.fecha_fin_Emision}}</th>
                <th><a href="{% url 'documento-actualizar' documento.pk %}" class="btn btn-teal"> Modificar </a></th>
                <th><a href="{% url 'documento-eliminar' documento.pk %}"onclick="window.opener.location.reload('{% url 'documento-eliminar' documento.pk %}');" class="btn btn-danger"> Eliminar </a></th>
               
            </tr>           
            {% endfor %} 
            <!--Fin Loop-->
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
  function exportTableToExcel(tableID, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById(tableID);
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
    
    // Specify file name
    filename = filename?filename+'.xlsx':'DocumentosCarga.xls';
    
    // Create download link element
    downloadLink = document.createElement("a");
    
    document.body.appendChild(downloadLink);
    
    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['ufeff', tableHTML], {
            type: dataType
        });
        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    
        // Setting the file name
        downloadLink.download = filename;
        
        //triggering the function
        downloadLink.click();
    }
  }
  }
</script>

<script>
  function fileValidation(){
      var fileInput = document.getElementById('file');
      var filePath = fileInput.value;
      var allowedExtensions = /(.xlsx|.xls|.csv)$/i;
      if(!allowedExtensions.exec(filePath)){
          alert('Porfavor, Adjuntar Archivos formato: .xlsx/ .xls/ .csv.');
          fileInput.value = '';
          return false;
      }else{
          //Image preview
          if (fileInput.files && fileInput.files[0]) {
              var reader = new FileReader();
              reader.onload = function(e) {
                  document.getElementById('imagePreview').innerHTML = '<img src="'+e.target.result+'"/>';
              };
              reader.readAsDataURL(fileInput.files[0]);
          }
      }
  }
</script>
  
    
   
{% endblock content %}
    