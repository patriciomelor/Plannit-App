{% extends 'index-config.html' %}

{% load crispy_forms_tags %}

{% block content %}
<!--Titulo-->
  
  <div class="br-mainpanel">
    <div class="br-pageheader pd-y-15 pd-md-l-20">
      <nav class="breadcrumb pd-0 mg-0 tx-12">
        <a class="breadcrumb-item" > {{proyecto}} </a>
        <span class="breadcrumb-item active">Historial de Umbrales</span>
      </nav>
    </div>
    <div class="br-pagebody mg-t-5 pd-x-30">

     <div class="ht-65 bd bg-black-100 pd-x-20 d-flex align-items-center justify-content-start mg-t-20">
        <ul class="nav nav-gray-600 active-info tx-uppercase tx-12 tx-medium tx-spacing-2 flex-column flex-sm-row" role="tablist">
        {% if request.user.is_superuser == true %}
          <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="{% url 'lista-proyecto' %}" role="tab">Lista de Proyectos</a></li>
          <li class="nav-item"><a class="nav-link" data-toggle="tab" href="{% url 'crear-proyecto' %}" role="tab">Agregar Proyectos</a></li>
        {% else %}
        {% endif %}
           <li class="nav-item">
            <div class="dropdown">
              <button class="btn btn-light dropdown-toggle nav-link" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="icon ion-person-stalker"></i>Gestionar Usuarios
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <a class="nav-link" href="{% url 'crear-usuario' %}"><button class="dropdown-item" type="button"><i class="icon ion-person-add"></i> Agregar Usuario</button></a>
                <a class="nav-link" href="{% url 'listar-usuarios' %}"><button class="dropdown-item" type="button"><i class="icon ion-person"></i> Listar Usuarios</button></a>
                <a class="nav-link" href="{% url 'add-user-proyecto' %}"><button class="dropdown-item" type="button"><i class="fas fa-user-chart"></i>Agregar Usuarios a Proyectos</button></a>
                
              </div>
            
            </div>
          </li>
          <li class="nav-item">
            <div class="dropdown">
            <button class="btn btn-light dropdown-toggle nav-link" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Restricciones
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
              <a class="nav-link" href="{% url 'restriccion' %}"><button class="dropdown-item" type="button">Restricciones</button></a>
              <a class="nav-link" href="{% url 'no-cumplimiento' %}"><button class="dropdown-item" type="button">No cumplimiento</button></a>
              
            </div>
          </div>
            </li>
          <li class="nav-item"><a class="nav-link"  href="{% url 'list-umbrales' %}">Umbrales</a></li>
          <li class="nav-item"><a class="nav-link"  href="{% url 'list-notif-umbrales' %}">Historial Umbrales</a></li>
        </ul>
      </div><!-- ht-65 -->
      <div class="br-section-wrapper">    
        <div class="pd-x-20 pd-sm-x-30 mg-b-10">
          <h4 class="tx-gray-800 mg-b-5">Lista de Umbrales / {{proyecto}}</h4>
        </div> 

        <div class="row row-sm d-flex justify-content-center">
          <table class="datatable table table-responsive table-striped mg-b-0 table-bordered table-primary"id="datatable1">       
      <!--Table-->
              <thead>
                <tr>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Nombre</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Descripción</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Tiempo de Control</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Variable de Atraso</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Última<br>Revisión</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: white;">Acción</th>

                </tr>
              </thead>
              <tbody>
              {% for umbral in umbrales_notificados %}
                <tr>            
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;" >{{umbral.h_umbral.umbral.nombre}}  </th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;" >{{umbral.h_umbral.umbral.descripcion}}  </th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;" >{{umbral.h_umbral.tiempo_control}} </th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;" >{{umbral.h_umbral.variable_atraso}}  </th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;" >{{umbral.h_umbral.last_checked|date:'d-M-y'}}</th>
                  <th style="text-align: center;border: 2px;border-color: grey; color: black;"><a href="{% url 'detail-notif-umbrales' umbral.pk %}"> <i class="icon ion-eye"></i> </a></th>
                </tr>
            {% endfor %}
                <!--Fin Loop-->
              </tbody>
            </table>
        </div>
      </div>  
  </div>
</div>
<script>
  $(document).ready(function () {
    $("#datatable1").DataTable({
      dom: 'B<"float-right"f>t<"float-left"l>p<"clearfix">',
      paging: true,
      pageLength: 5,
      responsive: true,
      language: {
        url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json",
      },

      buttons: {
        dom: {
          button: {
            className: "btn btn-success",
          },
        },
      },
      buttons: [
        {
          //definimos estilos del boton de excel
          extend: "excel",
          text: "Exportar a Excel",
          className: "btn btn-success",

          // 1 - ejemplo básico - uso de templates pre-definidos
          //definimos los parametros al exportar a excel

          excelStyles: {
            template: "header_blue", // Apply the 'header_blue' template part (white font on a blue background in the header/footer)
            template: "green_medium",

            template: ["blue_medium", "header_green", "title_medium"],
          },
        },
      ],
    });
  });
</script>
{% endblock content %}
